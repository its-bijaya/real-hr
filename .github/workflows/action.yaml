name: Build Docker Image and Push

on:
    
  push: 
    branches: ['main']

  workflow_dispatch:



jobs:
       build:
        runs-on: ubuntu-latest

        steps:
          - name: Check out the repo
            uses: actions/checkout@v4

          - name: Set up Node.js
            uses: actions/setup-node@v3
            with:
                node-version: '20'

          - name: Install dependencies
            run: npm install

          - name: Build Vitepress
            run: npm run docs:build

          - name: Build & push Docker image
            uses: mr-smithers-excellent/docker-build-push@v6
            with:
              image: itsbijaya/real-hr
              tags: latest
              registry: docker.io
              dockerfile: Dockerfile
              username: ${{ secrets.DOCKER_USERNAME }}
              password: ${{ secrets.DOCKER_PASSWORD }}
          
          - name: Start SSH
            uses: appleboy/ssh-action@v1.0.3
            with:
                host: 192.168.1.99
                username: itsbijaya
                port: 22
                key: ${{ secrets.SSHKEY }}
                script: "docker pull itsbijaya/real-hr:latest && docker run -d -p 8085:80 --name real-hr itsbijaya/real-hr:latest"
           
        # - name: Pull docker image
        #   run: docker pull itsbijaya/real-hr:latest 

        # - name: Build Docker Image
        #   run: docker build -t itsbijaya/real-hr:latest .

        # - name: Build Docker Image
        #   run: docker run -d -p 8085:80 --name real-hr itsbijaya/real-hr:latest 